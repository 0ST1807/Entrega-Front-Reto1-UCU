<div class="dashboard">
  <mat-toolbar color="primary">
    <span>Gestión de Personas</span>
    <span class="spacer"></span>
    <button mat-button color="accent" type="button" (click)="logout()">
      Cerrar sesión
    </button>
  </mat-toolbar>

  <div class="content">
    <mat-card class="form-card">
      <mat-card-header>
        <mat-card-title>{{ editingPerson ? 'Editar persona' : 'Nueva persona' }}</mat-card-title>
        <mat-card-subtitle>
          Complete los datos para {{ editingPerson ? 'actualizar' : 'crear' }} un registro
        </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <form class="person-form" [formGroup]="form" (ngSubmit)="submit()">
          <div class="form-grid">
            <mat-form-field appearance="outline">
              <mat-label>Nombre</mat-label>
              <input matInput formControlName="nombre" placeholder="Ingrese el nombre">
              <mat-error *ngIf="form.get('nombre')?.hasError('required')">
                El nombre es obligatorio
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Apellido</mat-label>
              <input matInput formControlName="apellido" placeholder="Ingrese el apellido">
              <mat-error *ngIf="form.get('apellido')?.hasError('required')">
                El apellido es obligatorio
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Edad</mat-label>
              <input matInput type="number" formControlName="edad" min="0" max="120">
              <mat-error *ngIf="form.get('edad')?.hasError('required')">
                La edad es obligatoria
              </mat-error>
              <mat-error *ngIf="form.get('edad')?.hasError('min') || form.get('edad')?.hasError('max')">
                Ingrese una edad válida
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Email</mat-label>
              <input matInput type="email" formControlName="email" placeholder="nombre@mail.com">
              <mat-error *ngIf="form.get('email')?.hasError('required')">
                El email es obligatorio
              </mat-error>
              <mat-error *ngIf="form.get('email')?.hasError('email')">
                Ingrese un email válido
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Teléfono</mat-label>
              <input matInput formControlName="telefono" placeholder="Ingrese el teléfono">
              <mat-error *ngIf="form.get('telefono')?.hasError('required')">
                El teléfono es obligatorio
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Ciudad</mat-label>
              <input matInput formControlName="ciudad" placeholder="Ingrese la ciudad">
              <mat-error *ngIf="form.get('ciudad')?.hasError('required')">
                La ciudad es obligatoria
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-actions">
            <button mat-stroked-button color="primary" type="button" (click)="cancelEdit()" *ngIf="editingPerson">
              Cancelar
            </button>
            <span class="spacer"></span>
            <button mat-raised-button color="accent" type="submit" [disabled]="form.invalid || isSaving">
              {{ editingPerson ? 'Actualizar' : 'Crear' }}
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>

    <mat-card class="table-card">
      <mat-card-header>
        <mat-card-title>Listado de personas</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-progress-bar *ngIf="isLoading" mode="indeterminate"></mat-progress-bar>

        <div class="table-wrapper">
          <table mat-table [dataSource]="dataSource" matSort matSortDisableClear>

            <ng-container matColumnDef="nombre">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombre</th>
              <td mat-cell *matCellDef="let person">{{ person.nombre }}</td>
            </ng-container>

            <ng-container matColumnDef="apellido">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Apellido</th>
              <td mat-cell *matCellDef="let person">{{ person.apellido }}</td>
            </ng-container>

            <ng-container matColumnDef="edad">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Edad</th>
              <td mat-cell *matCellDef="let person">{{ person.edad }}</td>
            </ng-container>

            <ng-container matColumnDef="email">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Email</th>
              <td mat-cell *matCellDef="let person">{{ person.email }}</td>
            </ng-container>

            <ng-container matColumnDef="telefono">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Teléfono</th>
              <td mat-cell *matCellDef="let person">{{ person.telefono }}</td>
            </ng-container>

            <ng-container matColumnDef="ciudad">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Ciudad</th>
              <td mat-cell *matCellDef="let person">{{ person.ciudad }}</td>
            </ng-container>

            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef class="actions-column">Acciones</th>
              <td mat-cell *matCellDef="let person" class="actions-column">
                <button mat-icon-button color="primary" type="button" (click)="startEdit(person)" aria-label="Editar">
                  <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button color="warn" type="button" (click)="delete(person)" aria-label="Eliminar">
                  <mat-icon>delete</mat-icon>
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            <tr mat-no-data-row *matNoDataRow>
              <td class="no-data" colspan="7">No hay registros para mostrar</td>
            </tr>
          </table>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
